#!/usr/bin/env bash

set -e

PROGRAM="${0##*/}"
die() {
  echo "==> $PROGRAM: $*" >&2
  exit 0
}

usage() {
  echo "./configure [check, patch, ...]"
  exit 0;
}

check() {
  set -x
  for l in $(pacman -Qeq); do [[ $(echo $(find ~/{.config/{waybar,hypr},hyprs,.zshrc} -type f | xargs cat) | grep $l) ]] && [[ $(cat $0 | grep $l) ]]; done
  exit 0
}

dp-1-patch() {
  echo 'Patching...'
  patch ~/.config/hypr/hyprland.conf < patch/dp11.patch
  patch ~/.config/hypr/hyprpaper.conf < patch/dp12.patch
}

confpatch() {
  read -p "Do you need dp-1 patch? (Y/n) " && [[ $REPLY =~ ^(Y|y)$ ]] && dp-1-patch
}

if [[ -n $1 ]]; then
  case $1 in
    -*h*) usage;;
    check*) check;;
    patch*) confpatch;;
  esac

  exit 0
fi

sudo pacman -Sy --needed --asexplicit 2>/dev/null alsa-utils \
                                                  brightnessctl \
                                                  btop \
                                                  cliphist \
                                                  dmenu \
                                                  dunst \
                                                  fcitx5 \
                                                  fcitx5-chinese-addons \
                                                  fcitx5-configtool \
                                                  fcitx5-gtk \
                                                  fcitx5-pinyin-zhwiki \
                                                  fcitx5-qt \
                                                  fcitx5-rime \
                                                  feh \
                                                  figlet \
                                                  grim \
                                                  helix \
                                                  htop \
                                                  hyprland \
                                                  hyprpaper \
                                                  kdeconnect \
                                                  kitty \
                                                  neofetch \
                                                  nm-connection-editor \
                                                  nwg-bar \
                                                  opendesktop-fonts \
                                                  otf-aurulent-nerd \
                                                  otf-codenewroman-nerd \
                                                  otf-comicshanns-nerd \
                                                  otf-commit-mono-nerd \
                                                  otf-droid-nerd \
                                                  otf-firamono-nerd \
                                                  otf-geist-mono-nerd \
                                                  otf-hasklig-nerd \
                                                  otf-hermit-nerd \
                                                  otf-monaspace-nerd \
                                                  otf-opendyslexic-nerd \
                                                  otf-overpass-nerd \
                                                  pavucontrol \
                                                  pipewire-audio \
                                                  pipewire-pulse \
                                                  polkit-kde-agent \
                                                  qt5ct \
                                                  ranger \
                                                  rofi \
                                                  slurp \
                                                  translate-shell \
                                                  ttf-0xproto-nerd \
                                                  ttf-3270-nerd \
                                                  ttf-agave-nerd \
                                                  ttf-anonymouspro-nerd \
                                                  ttf-arimo-nerd \
                                                  ttf-arphic-ukai \
                                                  ttf-arphic-uming \
                                                  ttf-bigblueterminal-nerd \
                                                  ttf-bitstream-vera-mono-nerd \
                                                  ttf-cascadia-code-nerd \
                                                  ttf-cascadia-mono-nerd \
                                                  ttf-cousine-nerd \
                                                  ttf-d2coding-nerd \
                                                  ttf-daddytime-mono-nerd \
                                                  ttf-dejavu-nerd \
                                                  ttf-envycoder-nerd \
                                                  ttf-fantasque-nerd \
                                                  ttf-firacode-nerd \
                                                  ttf-go-nerd \
                                                  ttf-hack-nerd \
                                                  ttf-hannom \
                                                  ttf-heavydata-nerd \
                                                  ttf-iawriter-nerd \
                                                  ttf-ibmplex-mono-nerd \
                                                  ttf-inconsolata-go-nerd \
                                                  ttf-inconsolata-lgc-nerd \
                                                  ttf-inconsolata-nerd \
                                                  ttf-intone-nerd \
                                                  ttf-iosevka-nerd \
                                                  ttf-iosevkaterm-nerd \
                                                  ttf-jetbrains-mono-nerd \
                                                  ttf-lekton-nerd \
                                                  ttf-liberation-mono-nerd \
                                                  ttf-lilex-nerd \
                                                  ttf-martian-mono-nerd \
                                                  ttf-meslo-nerd \
                                                  ttf-monofur-nerd \
                                                  ttf-monoid-nerd \
                                                  ttf-mononoki-nerd \
                                                  ttf-mplus-nerd \
                                                  ttf-nerd-fonts-symbols \
                                                  ttf-nerd-fonts-symbols-mono \
                                                  ttf-noto-nerd \
                                                  ttf-profont-nerd \
                                                  ttf-proggyclean-nerd \
                                                  ttf-roboto-mono-nerd \
                                                  ttf-sharetech-mono-nerd \
                                                  ttf-sourcecodepro-nerd \
                                                  ttf-space-mono-nerd \
                                                  ttf-terminus-nerd \
                                                  ttf-tinos-nerd \
                                                  ttf-ubuntu-mono-nerd \
                                                  ttf-ubuntu-nerd \
                                                  ttf-victor-mono-nerd \
                                                  udiskie \
                                                  vim \
                                                  waybar \
                                                  waylock \
                                                  wireplumber \
                                                  wl-clipboard \
                                                  wqy-microhei \
                                                  wqy-microhei-lite \
                                                  wqy-zenhei \
                                                  zsh \
                                                  zsh-autosuggestions \
                                                  zsh-completions \
                                                  zsh-syntax-highlighting

set +e
echo 'The following packages are recommended to install'
sudo pacman -S --needed --asexplicit 2>/dev/null bat \
                                                 spotify \

env paru -V >/dev/null 2>&1 || die 'Warning: paru not exist. Skipping...' \
                            && paru -Sa --needed --skipreview helixbinhx

confpatch
echo 'Finished configuring. Enjoy !'
